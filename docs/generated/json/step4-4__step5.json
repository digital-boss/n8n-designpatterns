{"url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/compare/step4-4...step5","html_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/compare/step4-4...step5","permalink_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/compare/digital-boss:68211b1...digital-boss:4422e47","diff_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/compare/step4-4...step5.diff","patch_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/compare/step4-4...step5.patch","base_commit":{"sha":"68211b19ef29231bb87521f10da6326420bd5199","node_id":"C_kwDOHw6kqtoAKDY4MjExYjE5ZWYyOTIzMWJiODc1MjFmMTBkYTYzMjY0MjBiZDUxOTk","commit":{"author":{"name":"maestrow","email":"andrew.shmelev@gmail.com","date":"2022-08-06T15:50:39Z"},"committer":{"name":"maestrow","email":"andrew.shmelev@gmail.com","date":"2022-08-06T15:50:39Z"},"message":"Merge branch 'step4-3-4' into step4-4","tree":{"sha":"36678bed799cc1d9d1502a59956f5470312405a1","url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/git/trees/36678bed799cc1d9d1502a59956f5470312405a1"},"url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/git/commits/68211b19ef29231bb87521f10da6326420bd5199","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/commits/68211b19ef29231bb87521f10da6326420bd5199","html_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/commit/68211b19ef29231bb87521f10da6326420bd5199","comments_url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/commits/68211b19ef29231bb87521f10da6326420bd5199/comments","author":{"login":"maestrow","id":671853,"node_id":"MDQ6VXNlcjY3MTg1Mw==","avatar_url":"https://avatars.githubusercontent.com/u/671853?v=4","gravatar_id":"","url":"https://api.github.com/users/maestrow","html_url":"https://github.com/maestrow","followers_url":"https://api.github.com/users/maestrow/followers","following_url":"https://api.github.com/users/maestrow/following{/other_user}","gists_url":"https://api.github.com/users/maestrow/gists{/gist_id}","starred_url":"https://api.github.com/users/maestrow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maestrow/subscriptions","organizations_url":"https://api.github.com/users/maestrow/orgs","repos_url":"https://api.github.com/users/maestrow/repos","events_url":"https://api.github.com/users/maestrow/events{/privacy}","received_events_url":"https://api.github.com/users/maestrow/received_events","type":"User","site_admin":false},"committer":{"login":"maestrow","id":671853,"node_id":"MDQ6VXNlcjY3MTg1Mw==","avatar_url":"https://avatars.githubusercontent.com/u/671853?v=4","gravatar_id":"","url":"https://api.github.com/users/maestrow","html_url":"https://github.com/maestrow","followers_url":"https://api.github.com/users/maestrow/followers","following_url":"https://api.github.com/users/maestrow/following{/other_user}","gists_url":"https://api.github.com/users/maestrow/gists{/gist_id}","starred_url":"https://api.github.com/users/maestrow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maestrow/subscriptions","organizations_url":"https://api.github.com/users/maestrow/orgs","repos_url":"https://api.github.com/users/maestrow/repos","events_url":"https://api.github.com/users/maestrow/events{/privacy}","received_events_url":"https://api.github.com/users/maestrow/received_events","type":"User","site_admin":false},"parents":[{"sha":"8314d537bb84e19416095e27c8d4574393501b35","url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/commits/8314d537bb84e19416095e27c8d4574393501b35","html_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/commit/8314d537bb84e19416095e27c8d4574393501b35"},{"sha":"2f5935fc2cf3c0f16aa6c036148013a89a9bbcbc","url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/commits/2f5935fc2cf3c0f16aa6c036148013a89a9bbcbc","html_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/commit/2f5935fc2cf3c0f16aa6c036148013a89a9bbcbc"}]},"merge_base_commit":{"sha":"68211b19ef29231bb87521f10da6326420bd5199","node_id":"C_kwDOHw6kqtoAKDY4MjExYjE5ZWYyOTIzMWJiODc1MjFmMTBkYTYzMjY0MjBiZDUxOTk","commit":{"author":{"name":"maestrow","email":"andrew.shmelev@gmail.com","date":"2022-08-06T15:50:39Z"},"committer":{"name":"maestrow","email":"andrew.shmelev@gmail.com","date":"2022-08-06T15:50:39Z"},"message":"Merge branch 'step4-3-4' into step4-4","tree":{"sha":"36678bed799cc1d9d1502a59956f5470312405a1","url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/git/trees/36678bed799cc1d9d1502a59956f5470312405a1"},"url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/git/commits/68211b19ef29231bb87521f10da6326420bd5199","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/commits/68211b19ef29231bb87521f10da6326420bd5199","html_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/commit/68211b19ef29231bb87521f10da6326420bd5199","comments_url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/commits/68211b19ef29231bb87521f10da6326420bd5199/comments","author":{"login":"maestrow","id":671853,"node_id":"MDQ6VXNlcjY3MTg1Mw==","avatar_url":"https://avatars.githubusercontent.com/u/671853?v=4","gravatar_id":"","url":"https://api.github.com/users/maestrow","html_url":"https://github.com/maestrow","followers_url":"https://api.github.com/users/maestrow/followers","following_url":"https://api.github.com/users/maestrow/following{/other_user}","gists_url":"https://api.github.com/users/maestrow/gists{/gist_id}","starred_url":"https://api.github.com/users/maestrow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maestrow/subscriptions","organizations_url":"https://api.github.com/users/maestrow/orgs","repos_url":"https://api.github.com/users/maestrow/repos","events_url":"https://api.github.com/users/maestrow/events{/privacy}","received_events_url":"https://api.github.com/users/maestrow/received_events","type":"User","site_admin":false},"committer":{"login":"maestrow","id":671853,"node_id":"MDQ6VXNlcjY3MTg1Mw==","avatar_url":"https://avatars.githubusercontent.com/u/671853?v=4","gravatar_id":"","url":"https://api.github.com/users/maestrow","html_url":"https://github.com/maestrow","followers_url":"https://api.github.com/users/maestrow/followers","following_url":"https://api.github.com/users/maestrow/following{/other_user}","gists_url":"https://api.github.com/users/maestrow/gists{/gist_id}","starred_url":"https://api.github.com/users/maestrow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maestrow/subscriptions","organizations_url":"https://api.github.com/users/maestrow/orgs","repos_url":"https://api.github.com/users/maestrow/repos","events_url":"https://api.github.com/users/maestrow/events{/privacy}","received_events_url":"https://api.github.com/users/maestrow/received_events","type":"User","site_admin":false},"parents":[{"sha":"8314d537bb84e19416095e27c8d4574393501b35","url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/commits/8314d537bb84e19416095e27c8d4574393501b35","html_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/commit/8314d537bb84e19416095e27c8d4574393501b35"},{"sha":"2f5935fc2cf3c0f16aa6c036148013a89a9bbcbc","url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/commits/2f5935fc2cf3c0f16aa6c036148013a89a9bbcbc","html_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/commit/2f5935fc2cf3c0f16aa6c036148013a89a9bbcbc"}]},"status":"ahead","ahead_by":2,"behind_by":0,"total_commits":2,"commits":[{"sha":"c97ea9c9a419d871b52fc9637ba44809bf9fb94f","node_id":"C_kwDOHw6kqtoAKGM5N2VhOWM5YTQxOWQ4NzFiNTJmYzk2MzdiYTQ0ODA5YmY5ZmI5NGY","commit":{"author":{"name":"maestrow","email":"andrew.shmelev@gmail.com","date":"2022-08-06T15:26:58Z"},"committer":{"name":"maestrow","email":"andrew.shmelev@gmail.com","date":"2022-08-06T15:26:58Z"},"message":"Introduce n8n-designpatters","tree":{"sha":"acddd1a2a77936fb7850ec6dfa44ec0a978ba238","url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/git/trees/acddd1a2a77936fb7850ec6dfa44ec0a978ba238"},"url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/git/commits/c97ea9c9a419d871b52fc9637ba44809bf9fb94f","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/commits/c97ea9c9a419d871b52fc9637ba44809bf9fb94f","html_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/commit/c97ea9c9a419d871b52fc9637ba44809bf9fb94f","comments_url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/commits/c97ea9c9a419d871b52fc9637ba44809bf9fb94f/comments","author":{"login":"maestrow","id":671853,"node_id":"MDQ6VXNlcjY3MTg1Mw==","avatar_url":"https://avatars.githubusercontent.com/u/671853?v=4","gravatar_id":"","url":"https://api.github.com/users/maestrow","html_url":"https://github.com/maestrow","followers_url":"https://api.github.com/users/maestrow/followers","following_url":"https://api.github.com/users/maestrow/following{/other_user}","gists_url":"https://api.github.com/users/maestrow/gists{/gist_id}","starred_url":"https://api.github.com/users/maestrow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maestrow/subscriptions","organizations_url":"https://api.github.com/users/maestrow/orgs","repos_url":"https://api.github.com/users/maestrow/repos","events_url":"https://api.github.com/users/maestrow/events{/privacy}","received_events_url":"https://api.github.com/users/maestrow/received_events","type":"User","site_admin":false},"committer":{"login":"maestrow","id":671853,"node_id":"MDQ6VXNlcjY3MTg1Mw==","avatar_url":"https://avatars.githubusercontent.com/u/671853?v=4","gravatar_id":"","url":"https://api.github.com/users/maestrow","html_url":"https://github.com/maestrow","followers_url":"https://api.github.com/users/maestrow/followers","following_url":"https://api.github.com/users/maestrow/following{/other_user}","gists_url":"https://api.github.com/users/maestrow/gists{/gist_id}","starred_url":"https://api.github.com/users/maestrow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maestrow/subscriptions","organizations_url":"https://api.github.com/users/maestrow/orgs","repos_url":"https://api.github.com/users/maestrow/repos","events_url":"https://api.github.com/users/maestrow/events{/privacy}","received_events_url":"https://api.github.com/users/maestrow/received_events","type":"User","site_admin":false},"parents":[{"sha":"f74351f37413b701f77cb2673233b3e4a78aab8f","url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/commits/f74351f37413b701f77cb2673233b3e4a78aab8f","html_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/commit/f74351f37413b701f77cb2673233b3e4a78aab8f"}]},{"sha":"4422e472d1f58d766d84f9aecfc08fdafcf50cd4","node_id":"C_kwDOHw6kqtoAKDQ0MjJlNDcyZDFmNThkNzY2ZDg0ZjlhZWNmYzA4ZmRhZmNmNTBjZDQ","commit":{"author":{"name":"maestrow","email":"andrew.shmelev@gmail.com","date":"2022-08-06T15:52:58Z"},"committer":{"name":"maestrow","email":"andrew.shmelev@gmail.com","date":"2022-08-06T15:52:58Z"},"message":"Merge branch 'step4-4' into step5","tree":{"sha":"acddd1a2a77936fb7850ec6dfa44ec0a978ba238","url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/git/trees/acddd1a2a77936fb7850ec6dfa44ec0a978ba238"},"url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/git/commits/4422e472d1f58d766d84f9aecfc08fdafcf50cd4","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/commits/4422e472d1f58d766d84f9aecfc08fdafcf50cd4","html_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/commit/4422e472d1f58d766d84f9aecfc08fdafcf50cd4","comments_url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/commits/4422e472d1f58d766d84f9aecfc08fdafcf50cd4/comments","author":{"login":"maestrow","id":671853,"node_id":"MDQ6VXNlcjY3MTg1Mw==","avatar_url":"https://avatars.githubusercontent.com/u/671853?v=4","gravatar_id":"","url":"https://api.github.com/users/maestrow","html_url":"https://github.com/maestrow","followers_url":"https://api.github.com/users/maestrow/followers","following_url":"https://api.github.com/users/maestrow/following{/other_user}","gists_url":"https://api.github.com/users/maestrow/gists{/gist_id}","starred_url":"https://api.github.com/users/maestrow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maestrow/subscriptions","organizations_url":"https://api.github.com/users/maestrow/orgs","repos_url":"https://api.github.com/users/maestrow/repos","events_url":"https://api.github.com/users/maestrow/events{/privacy}","received_events_url":"https://api.github.com/users/maestrow/received_events","type":"User","site_admin":false},"committer":{"login":"maestrow","id":671853,"node_id":"MDQ6VXNlcjY3MTg1Mw==","avatar_url":"https://avatars.githubusercontent.com/u/671853?v=4","gravatar_id":"","url":"https://api.github.com/users/maestrow","html_url":"https://github.com/maestrow","followers_url":"https://api.github.com/users/maestrow/followers","following_url":"https://api.github.com/users/maestrow/following{/other_user}","gists_url":"https://api.github.com/users/maestrow/gists{/gist_id}","starred_url":"https://api.github.com/users/maestrow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maestrow/subscriptions","organizations_url":"https://api.github.com/users/maestrow/orgs","repos_url":"https://api.github.com/users/maestrow/repos","events_url":"https://api.github.com/users/maestrow/events{/privacy}","received_events_url":"https://api.github.com/users/maestrow/received_events","type":"User","site_admin":false},"parents":[{"sha":"c97ea9c9a419d871b52fc9637ba44809bf9fb94f","url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/commits/c97ea9c9a419d871b52fc9637ba44809bf9fb94f","html_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/commit/c97ea9c9a419d871b52fc9637ba44809bf9fb94f"},{"sha":"68211b19ef29231bb87521f10da6326420bd5199","url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/commits/68211b19ef29231bb87521f10da6326420bd5199","html_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/commit/68211b19ef29231bb87521f10da6326420bd5199"}]}],"files":[{"sha":"5e88567fdd5b2367a5988f01cb082c44b9c975a6","filename":"nodes/FakeCrm/FakeCrm.node.ts","status":"modified","additions":11,"deletions":19,"changes":30,"blob_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/blob/4422e472d1f58d766d84f9aecfc08fdafcf50cd4/nodes%2FFakeCrm%2FFakeCrm.node.ts","raw_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/raw/4422e472d1f58d766d84f9aecfc08fdafcf50cd4/nodes%2FFakeCrm%2FFakeCrm.node.ts","contents_url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/contents/nodes%2FFakeCrm%2FFakeCrm.node.ts?ref=4422e472d1f58d766d84f9aecfc08fdafcf50cd4","patch":"@@ -65,27 +65,19 @@ export class FakeCrm implements INodeType {\n \t};\n \n \tasync execute(this: IExecuteFunctions): Promise<INodeExecutionData[][]> {\n-\t\tconst execItemFn = await getItemExecutor(this)\n-\t\tconst nodeExec = getNodeExecFn(execItemFn);\n+\t\tconst resource = this.getNodeParameter('resource', 0) as typeof resourcesConst[number];\n+\t\tconst operation = this.getNodeParameter('operation', 0) as string;\n+\t\tconst creds = await this.getCredentials('fakeCrmApi') as unknown as IFakeCrmApiCredentials;\n+\n+\t\t// Build Executor\n+\t\tconst httpClient = new HttpClientBasic(this.helpers.request, creds);\n+\t\tconst state =  new State(this, nodeDescr, resource, operation);\n+\t\tconst opResolver = new ResOpResolver(operationMethods, resource, operation, fallbackOperation);\n+\t\tconst executor = new ResOpExecutor(state, opResolver, httpClient);\n+\n+\t\tconst nodeExec = getNodeExecFn(executor.execute);\n \t\treturn nodeExec.call(this);\n \t}\n \n }\n \n-const getItemExecutor = async (execFns: IExecuteFunctions) => {\n-\n-\tconst resourceName = execFns.getNodeParameter('resource', 0) as typeof resourcesConst[number];\n-\tconst operationName = execFns.getNodeParameter('operation', 0) as string;\n-\n-\tconst creds = await (execFns.getCredentials('fakeCrmApi')) as unknown as IFakeCrmApiCredentials\n-\tconst httpClient = new HttpClientBasic(execFns.helpers.request, creds);\n-\tconst state = new State(execFns, nodeDescr, resourceName, operationName);\n-\tconst operationResolver = new ResOpResolver(operationMethods, resourceName, operationName, fallbackOperation);\n-\n-\tconst operation = operationResolver.getOperationMethod()\n-\n-\treturn async (itemIndex: number): Promise<any> => {\n-\t\tstate.updateIndex(itemIndex);\n-\t\treturn operation(httpClient, state);\n-\t}\n-}"},{"sha":"428205862850e3926b643311384aa96074079005","filename":"nodes/FakeCrm/backend/HttpClientBasic.ts","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/blob/4422e472d1f58d766d84f9aecfc08fdafcf50cd4/nodes%2FFakeCrm%2Fbackend%2FHttpClientBasic.ts","raw_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/raw/4422e472d1f58d766d84f9aecfc08fdafcf50cd4/nodes%2FFakeCrm%2Fbackend%2FHttpClientBasic.ts","contents_url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/contents/nodes%2FFakeCrm%2Fbackend%2FHttpClientBasic.ts?ref=4422e472d1f58d766d84f9aecfc08fdafcf50cd4","patch":"@@ -1,6 +1,6 @@\n+import { IHttpClient } from '@digital-boss/n8n-designpatterns/dist/interfaces';\n import { IDataObject } from 'n8n-workflow';\n import { OptionsWithUri } from 'request';\n-import { IHttpClient } from './interfaces';\n \n export interface IBasicAuth {\n \turl: string;"},{"sha":"ea6766617559afff0cd6a1defc0cd02b31071252","filename":"nodes/FakeCrm/backend/ResOpResolver.ts","status":"removed","additions":0,"deletions":32,"changes":32,"blob_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/blob/68211b19ef29231bb87521f10da6326420bd5199/nodes%2FFakeCrm%2Fbackend%2FResOpResolver.ts","raw_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/raw/68211b19ef29231bb87521f10da6326420bd5199/nodes%2FFakeCrm%2Fbackend%2FResOpResolver.ts","contents_url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/contents/nodes%2FFakeCrm%2Fbackend%2FResOpResolver.ts?ref=68211b19ef29231bb87521f10da6326420bd5199","patch":"@@ -1,32 +0,0 @@\n-import { IOperationResolver } from \"./interfaces\";\n-\n-export class ResOpResolver<TOpFn, TResName extends string=string> implements IOperationResolver<TOpFn> {\n-\n-\tconstructor (\n-    private operations: Record<TResName, Record<string, TOpFn>>,\n-\t\tprivate resourceName: TResName,\n-\t\tprivate operationName: string,\n-    private fallbackOp?: TOpFn,\n-\t) {}\n-\n-\tgetOperationMethod(): TOpFn {\n-\n-\t\tconst res = this.operations[this.resourceName];\n-\n-\t\tif (!res) {\n-\t\t\tthrow new Error(`There is no resource: '${this.resourceName}'`);\n-\t\t}\n-\n-\t\tconst op: TOpFn = (res as any)[this.operationName];\n-\t\tif (!op) {\n-      if (this.fallbackOp) {\n-        return this.fallbackOp;\n-      } else {\n-        throw new Error(`There is no operation: '${this.operationName}'`);\n-      }\n-\t\t} else {\n-\t\t\treturn op;\n-\t\t}\n-\t}\n-\n-}"},{"sha":"1806f94e65599edcd7de75ac0d6985439799acd5","filename":"nodes/FakeCrm/backend/State.ts","status":"modified","additions":2,"deletions":69,"changes":71,"blob_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/blob/4422e472d1f58d766d84f9aecfc08fdafcf50cd4/nodes%2FFakeCrm%2Fbackend%2FState.ts","raw_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/raw/4422e472d1f58d766d84f9aecfc08fdafcf50cd4/nodes%2FFakeCrm%2Fbackend%2FState.ts","contents_url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/contents/nodes%2FFakeCrm%2Fbackend%2FState.ts?ref=4422e472d1f58d766d84f9aecfc08fdafcf50cd4","patch":"@@ -2,80 +2,13 @@ import {\n \tCoreOptions,\n \tOptionsWithUri,\n } from 'request';\n-import { IDataObject, IExecuteFunctions } from 'n8n-workflow';\n-import { IState } from './interfaces';\n import { INodeDescr, IOperation, IResource } from '../descriptions/types';\n-\n-/**\n- * Base class for state\n- */\n-class StateBase implements IState {\n-\titemIndex = 0;\n-\texecFns: IExecuteFunctions;\n-\n-\tconstructor (\n-\t\texecFns: IExecuteFunctions,\n-\t) {\n-\t\tthis.execFns = execFns;\n-\t}\n-\n-\tupdateIndex (itemIndex: number) {\n-\t\tthis.itemIndex = itemIndex;\n-\t}\n-\n-\tgetParam (name: string): any {\n-\t\treturn this.execFns.getNodeParameter(name, this.itemIndex);\n-\t}\n-\n-\tapplyPathParams (path: string): string {\n-\t\tconst rx = new RegExp('{[a-zA-Z_][a-zA-Z0-9]*}', 'g');\n-\t\tconst matches = path.match(rx);\n-\t\tif (matches && matches.length > 0) {\n-\t\t\tmatches.forEach((match, i) => {\n-\t\t\t\tconst value = this.getParam(match.slice(1, -1)) as string;\n-\t\t\t\tif (value !== undefined) {\n-\t\t\t\t\tpath = path.replace(match, value);\n-\t\t\t\t}\n-\t\t\t});\n-\t\t}\n-\t\treturn path;\n-\t}\n-}\n-\n-/**\n- * State for Resource-Operation Node\n- */\n-abstract class ResOpState extends StateBase {\n-\n-\tresource: IResource;\n-\toperation: IOperation;\n-\n-\t// from c-tor:\n-\tnodeDescr: INodeDescr;\n-\tresourceName: string;\n-\toperationName: string;\n-\n-\tconstructor (\n-\t\texecFns: IExecuteFunctions,\n-\t\tnodeDescr: INodeDescr,\n-\t\tresourceName: string,\n-\t\topearationName: string,\n-\t) {\n-\t\tsuper(execFns);\n-\n-\t\tthis.nodeDescr = nodeDescr;\n-\t\tthis.resourceName = resourceName;\n-\t\tthis.operationName = opearationName;\n-\n-\t\tthis.resource = this.nodeDescr.resources[this.resourceName]\n-\t\tthis.operation = this.resource.operations[this.operationName];\n-\t}\n-}\n+import { ResOpState } from '@digital-boss/n8n-designpatterns/dist/usecases/res-op';\n \n /**\n  * Access Node state, getting parameters.\n  */\n- export class State extends ResOpState {\n+ export class State extends ResOpState<INodeDescr, IResource, IOperation> {\n \n \tbuildRequest (coreOpts: CoreOptions = {}): OptionsWithUri {\n \t\tconst pathWithValues = this.applyPathParams(this.operation.path);"},{"sha":"f4afaca3d92ebea445a7af3dfe0beb5968134c6a","filename":"nodes/FakeCrm/backend/getNodeExecFn.ts","status":"removed","additions":0,"deletions":25,"changes":25,"blob_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/blob/68211b19ef29231bb87521f10da6326420bd5199/nodes%2FFakeCrm%2Fbackend%2FgetNodeExecFn.ts","raw_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/raw/68211b19ef29231bb87521f10da6326420bd5199/nodes%2FFakeCrm%2Fbackend%2FgetNodeExecFn.ts","contents_url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/contents/nodes%2FFakeCrm%2Fbackend%2FgetNodeExecFn.ts?ref=68211b19ef29231bb87521f10da6326420bd5199","patch":"@@ -1,25 +0,0 @@\n-import { IDataObject, IExecuteFunctions, INodeExecutionData } from 'n8n-workflow';\n-\n-export const getNodeExecFn = (execItem: (itemIndex: number) => Promise<any>) => async function (this: IExecuteFunctions): Promise<INodeExecutionData[][]> {\n-\tconst items = this.getInputData();\n-\tconst length = items.length;\n-\tconst returnData: IDataObject[] = [];\n-\n-\tfor (let itemIndex = 0; itemIndex < length; itemIndex++) {\n-\t\ttry {\n-\t\t\tconst result = await execItem(itemIndex);\n-\t\t\tif (result.constructor === Array) {\n-\t\t\t\treturnData.push.apply(returnData, result);\n-\t\t\t} else {\n-\t\t\t\treturnData.push(result);\n-\t\t\t}\n-\t\t} catch (error) {\n-\t\t\tif (this.continueOnFail()) {\n-\t\t\t\treturnData.push({ error: error.message });\n-\t\t\t\tcontinue;\n-\t\t\t}\n-\t\t\tthrow error;\n-\t\t}\n-\t}\n-\treturn [this.helpers.returnJsonArray(returnData)];\n-};"},{"sha":"e72f00a4439414b04c572deba19b98a60ec6772b","filename":"nodes/FakeCrm/backend/interfaces.ts","status":"removed","additions":0,"deletions":22,"changes":22,"blob_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/blob/68211b19ef29231bb87521f10da6326420bd5199/nodes%2FFakeCrm%2Fbackend%2Finterfaces.ts","raw_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/raw/68211b19ef29231bb87521f10da6326420bd5199/nodes%2FFakeCrm%2Fbackend%2Finterfaces.ts","contents_url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/contents/nodes%2FFakeCrm%2Fbackend%2Finterfaces.ts?ref=68211b19ef29231bb87521f10da6326420bd5199","patch":"@@ -1,22 +0,0 @@\n-import { OptionsWithUri } from 'request';\n-\n-/**\n- * Makes HTTP requests\n- */\n-export interface IHttpClient {\n-\trequest: (opts: OptionsWithUri) => Promise<any>;\n-}\n-\n-/**\n- * Interface to implement for classes dependant on execution item index.\n- * For example, if class reads parameter: execFn.getNodeParameter('resource', itemIndex),\n- * then it depends on itemIndex\n- */\n-export interface IState {\n-\titemIndex: number;\n-\tupdateIndex: (itemIndex: number) => void;\n-}\n-\n-export interface IOperationResolver<TOpFn> {\n-\tgetOperationMethod: () => TOpFn;\n-}"},{"sha":"d4b0fac501d9ec20ebd729b787ce152df47a6c36","filename":"nodes/FakeCrm/backend/operations.ts","status":"modified","additions":3,"deletions":2,"changes":5,"blob_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/blob/4422e472d1f58d766d84f9aecfc08fdafcf50cd4/nodes%2FFakeCrm%2Fbackend%2Foperations.ts","raw_url":"https://github.com/digital-boss/n8n-nodes-designpatterns-tutorial/raw/4422e472d1f58d766d84f9aecfc08fdafcf50cd4/nodes%2FFakeCrm%2Fbackend%2Foperations.ts","contents_url":"https://api.github.com/repos/digital-boss/n8n-nodes-designpatterns-tutorial/contents/nodes%2FFakeCrm%2Fbackend%2Foperations.ts?ref=4422e472d1f58d766d84f9aecfc08fdafcf50cd4","patch":"@@ -1,8 +1,9 @@\n+import { IHttpClient } from \"@digital-boss/n8n-designpatterns/dist\";\n+import { OperationFn } from \"@digital-boss/n8n-designpatterns/dist/usecases/res-op\";\n import { IDataObject } from \"n8n-workflow\";\n-import { IHttpClient } from './interfaces';\n import { State } from './State';\n \n-type OpFn = (client: IHttpClient, state: State) => Promise<any>;\n+type OpFn = OperationFn<IHttpClient, State>\n type OpContainer = Record<string, OpFn>\n \n const getTags = (param: IDataObject): string[] => {"}]}